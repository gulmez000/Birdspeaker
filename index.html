<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuş Seslendirme Uygulaması</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            text-align: center;
            color: #2c3e50;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .record-section, .playlist-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        button.record {
            background-color: #e74c3c;
        }
        button.record:hover {
            background-color: #c0392b;
        }
        button.play {
            background-color: #2ecc71;
        }
        button.play:hover {
            background-color: #27ae60;
        }
        .audio-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 5px;
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
        }
        input[type="number"] {
            width: 60px;
            padding: 5px;
            margin: 0 5px;
        }
        .status {
            margin-top: 20px;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
        }
        .audio-label {
            width: 100px;
            margin-right: 10px;
            font-weight: bold;
        }
        .sequence-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        #playlist {
            margin-top: 10px;
            padding: 10px;
            border: 1px dashed #ccc;
            border-radius: 5px;
        }
        .delete-btn {
            background-color: #e74c3c;
            margin-left: 10px;
        }
        .status.playing {
            background-color: #d5f5e3;
            color: #27ae60;
        }
        .status.stopped {
            background-color: #fadbd8;
            color: #e74c3c;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Kuş Seslendirme Uygulaması</h1>
        
        <div class="record-section">
            <h2>Ses Kaydetme</h2>
            <div class="controls">
                <input type="text" id="recording-name" placeholder="Ses adı" value="Ses 1">
                <button id="record" class="record">Kayıt Başlat (5 sn)</button>
                <span id="recording-status"></span>
            </div>
            <div id="recordings-list"></div>
        </div>
        
        <div class="playlist-section">
            <h2>Çalma Listesi</h2>
            <div id="playlist-controls">
                <div class="sequence-item">
                    <select id="sound-select">
                        <option value="">Ses seçin</option>
                    </select>
                    <input type="number" id="duration" min="1" max="60" value="5" placeholder="Dakika">
                    <span>dakika</span>
                    <button id="add-to-playlist">Listeye Ekle</button>
                </div>
                <div class="sequence-item">
                    <span>Sessiz süre: </span>
                    <input type="number" id="silence-duration" min="0" max="120" value="10" placeholder="Dakika">
                    <span>dakika</span>
                    <button id="add-silence">Sessizlik Ekle</button>
                </div>
                <div class="sequence-item">
                    <span>Toplam tekrar sayısı: </span>
                    <input type="number" id="repeat-count" min="1" max="100" value="3">
                    <button id="start-sequence" class="play">Çalmayı Başlat</button>
                    <button id="stop-sequence">Durdur</button>
                </div>
            </div>
            
            <h3>Çalma Sırası:</h3>
            <div id="playlist"></div>
            
            <div id="player-status" class="status stopped">Hazır</div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Global değişkenler
            let mediaRecorder;
            let audioChunks = [];
            let recordings = [];
            let playlist = [];
            let isPlaying = false;
            let currentAudioIndex = 0;
            let currentRepeatCount = 0;
            let currentAudio = null;
            let silenceTimeout = null;

            // DOM elementleri
            const recordButton = document.getElementById('record');
            const recordingStatus = document.getElementById('recording-status');
            const recordingName = document.getElementById('recording-name');
            const recordingsList = document.getElementById('recordings-list');
            const soundSelect = document.getElementById('sound-select');
            const durationInput = document.getElementById('duration');
            const silenceDurationInput = document.getElementById('silence-duration');
            const repeatCountInput = document.getElementById('repeat-count');
            const addToPlaylistButton = document.getElementById('add-to-playlist');
            const addSilenceButton = document.getElementById('add-silence');
            const startSequenceButton = document.getElementById('start-sequence');
            const stopSequenceButton = document.getElementById('stop-sequence');
            const playlistContainer = document.getElementById('playlist');
            const playerStatus = document.getElementById('player-status');

            // Kayıt fonksiyonu
            recordButton.addEventListener('click', () => {
                if (mediaRecorder && mediaRecorder.state === 'recording') {
                    return;
                }

                navigator.mediaDevices.getUserMedia({ audio: true })
                    .then(stream => {
                        mediaRecorder = new MediaRecorder(stream);
                        audioChunks = [];

                        mediaRecorder.addEventListener('dataavailable', event => {
                            audioChunks.push(event.data);
                        });

                        mediaRecorder.addEventListener('stop', () => {
                            const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                            const audioUrl = URL.createObjectURL(audioBlob);
                            const name = recordingName.value || `Ses ${recordings.length + 1}`;

                            recordings.push({
                                id: Date.now(),
                                name,
                                url: audioUrl,
                                blob: audioBlob
                            });

                            updateRecordingsList();
                            updateSoundSelect();

                            recordingStatus.textContent = 'Kayıt tamamlandı!';
                            recordButton.disabled = false;
                        });

                        mediaRecorder.start();
                        recordButton.disabled = true;
                        recordingStatus.textContent = 'Kaydediliyor...';

                        setTimeout(() => {
                            if (mediaRecorder.state === 'recording') {
                                mediaRecorder.stop();
                            }
                        }, 5000);
                    })
                    .catch(error => {
                        console.error('Mikrofon erişimi hatası:', error);
                        recordingStatus.textContent = 'Mikrofon erişimi reddedildi!';
                    });
            });

            // Kayıt listesini güncelleme
            function updateRecordingsList() {
                recordingsList.innerHTML = '';

                recordings.forEach(recording => {
                    const audioItem = document.createElement('div');
                    audioItem.className = 'audio-item';

                    const audioLabel = document.createElement('div');
                    audioLabel.className = 'audio-label';
                    audioLabel.textContent = recording.name;

                  const audio = document.createElement('audio');
                    audio.controls = true;
                    audio.src = recording.url;

                    const deleteButton = document.createElement('button');
                    deleteButton.className = 'delete-btn';
                    deleteButton.textContent = 'Sil';
                    deleteButton.addEventListener('click', () => {
                        recordings = recordings.filter(r => r.id !== recording.id);
                        updateRecordingsList();
                        updateSoundSelect();

                        // Çalma listesinden de kaldır
                        playlist = playlist.filter(item => item.type !== 'sound' || item.id !== recording.id);
                        updatePlaylist();
                    });

                    audioItem.appendChild(audioLabel);
                    audioItem.appendChild(audio);
                    audioItem.appendChild(deleteButton);
                    recordingsList.appendChild(audioItem);
                });
            }

            // Ses seçimini güncelleme
            function updateSoundSelect() {
                soundSelect.innerHTML = '<option value="">Ses seçin</option>';

                recordings.forEach(recording => {
                    const option = document.createElement('option');
                    option.value = recording.id;
                    option.textContent = recording.name;
                    soundSelect.appendChild(option);
                });
            }

            // Playlist'e ses eklemek
            addToPlaylistButton.addEventListener('click', () => {
                const soundId = soundSelect.value;
                const duration = parseInt(durationInput.value) * 60 * 1000;  // dakika cinsinden çalma süresi
                const silenceDuration = parseInt(silenceDurationInput.value) * 60 * 1000;  // dakika cinsinden sessizlik süresi
                const repeatCount = parseInt(repeatCountInput.value);

                if (soundId && duration > 0 && repeatCount > 0) {
                    const recording = recordings.find(r => r.id == soundId);

                    if (recording) {
                        playlist.push({
                            type: 'sound',
                            id: recording.id,
                            name: recording.name,
                            url: recording.url,
                            duration,
                            silenceDuration,
                            repeatCount
                        });

                        updatePlaylist();
                    }
                }
            });

            // Playlist'e sessizlik eklemek
            addSilenceButton.addEventListener('click', () => {
                const silenceDuration = parseInt(silenceDurationInput.value) * 60 * 1000;

                if (silenceDuration > 0) {
                    playlist.push({
                        type: 'silence',
                        duration: silenceDuration
                    });

                    updatePlaylist();
                }
            });

            // Playlist'i güncelleme
            function updatePlaylist() {
                playlistContainer.innerHTML = '';

                playlist.forEach(item => {
                    const listItem = document.createElement('div');
                    listItem.className = 'audio-item';

                    if (item.type === 'sound') {
                        listItem.textContent = `${item.name} - ${item.duration / 60000} dakika`;
                    } else {
                        listItem.textContent = `Sessizlik - ${item.duration / 60000} dakika`;
                    }

                    playlistContainer.appendChild(listItem);
                });
            }

            // Çalma işlemi başlatma
            startSequenceButton.addEventListener('click', () => {
                if (playlist.length === 0) {
                    return;
                }

                isPlaying = true;
                currentAudioIndex = 0;
                currentRepeatCount = 0;
                playerStatus.textContent = 'Çalıyor...';
                playerStatus.classList.remove('stopped');
                playerStatus.classList.add('playing');
                playNext();
            });

            // Çalma işlemi durdurma
            stopSequenceButton.addEventListener('click', () => {
                isPlaying = false;
                playerStatus.textContent = 'Durduruldu';
                playerStatus.classList.remove('playing');
                playerStatus.classList.add('stopped');
            });

            // Bir sonraki öğeyi çalma
            function playNext() {
                if (!isPlaying || currentAudioIndex >= playlist.length) {
                    return;
                }

                const currentItem = playlist[currentAudioIndex];

                if (currentItem.type === 'sound') {
                    const audio = new Audio(currentItem.url);
                    audio.play();

                    audio.onended = () => {
                        // Ses bittiğinde sessizlik eklemek veya bir sonraki ses
                        if (currentItem.silenceDuration > 0) {
                            setTimeout(() => {
                                currentAudioIndex++;
                                playNext();
                            }, currentItem.silenceDuration);
                        } else {
                            currentAudioIndex++;
                            playNext();
                        }
                    };
                } else if (currentItem.type === 'silence') {
                    setTimeout(() => {
                        currentAudioIndex++;
                        playNext();
                    }, currentItem.duration);
                }
            }
        });
    </script>
</body>
</html>
