<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kuş Sesleri Oynatıcı</title>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f4f4f4;
    }
    .container {
      max-width: 600px;
      margin: auto;
      padding: 20px;
    }
    h2 {
      text-align: center;
      color: #2c3e50;
    }
    .section {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
      color: #2c3e50;
    }
    input, button {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      margin-bottom: 15px;
      border-radius: 8px;
      font-size: 16px;
    }
    input[type="file"],
    input[type="number"] {
      border: 1px solid #ccc;
    }
    button {
      background-color: #27ae60;
      color: white;
      border: none;
      font-weight: bold;
      cursor: pointer;
    }
    button:hover {
      background-color: #219150;
    }
    #stop-btn {
      background-color: #e74c3c;
    }
    #stop-btn:hover {
      background-color: #c0392b;
    }
    audio {
      width: 100%;
      margin-top: 15px;
    }
    .status {
      margin-top: 15px;
      text-align: center;
      font-weight: bold;
      color: #2c3e50;
    }
    .version {
      text-align: center;
      background-color: #2c3e50;
      color: white;
      padding: 10px 0;
      font-size: 16px;
    }
    @media (max-width: 600px) {
      input, button {
        font-size: 15px;
      }
    }
  </style>
</head>
<body>
  <!-- Kuş v1 ve güncelleme bilgisini gösteren kısım -->
  <div class="version">
    Kuş v1 | Son Güncelleme: Mayıs 2025
  </div>

  <div class="container">
    <h2>Kuş Sesleri Oynatıcı</h2>
    <div class="section">
      <label>Ses Dosyası Yükle:</label>
      <input type="file" id="audio-file" accept="audio/*" />

      <label>veya Kayıt Yap:</label>
      <button id="record-btn">Kayda Başla</button>
      <button id="stop-record-btn" disabled>Kaydı Durdur</button>

      <audio id="audio-player" controls></audio>
      <div id="download-container" style="display:none;">
        <a id="download-link" href="#" download="kayit.wav">
          <button>Kaydı İndir</button>
        </a>
      </div>

      <div class="status" id="status">Hazır</div>
    </div>
  </div>

  <script>
    const recordBtn = document.getElementById('record-btn');
    const stopRecordBtn = document.getElementById('stop-record-btn');
    const audioPlayer = document.getElementById('audio-player');
    const status = document.getElementById('status');
    const downloadContainer = document.getElementById('download-container');
    const downloadLink = document.getElementById('download-link');

    let mediaRecorder;
    let audioChunks = [];
    let audioBlob;
    let audioUrl;

    recordBtn.addEventListener('click', async () => {
      status.textContent = 'Kaydediliyor... Lütfen bekleyin.';
      recordBtn.disabled = true;
      stopRecordBtn.disabled = false;

      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      mediaRecorder = new MediaRecorder(stream);
      mediaRecorder.start();

      mediaRecorder.ondataavailable = (event) => {
        audioChunks.push(event.data);
      };

      mediaRecorder.onstop = () => {
        audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
        audioUrl = URL.createObjectURL(audioBlob);
        audioPlayer.src = audioUrl;

        const link = document.createElement('a');
        link.href = audioUrl;
        link.download = 'kayit.wav';
        downloadLink.href = link.href;
        downloadContainer.style.display = 'block';
        status.textContent = 'Kaydedildi!';

        // Temizle
        audioChunks = [];
      };
    });

    stopRecordBtn.addEventListener('click', () => {
      mediaRecorder.stop();
      stopRecordBtn.disabled = true;
      recordBtn.disabled = false;
      status.textContent = 'Kaydediliyor... Durdu.';
    });

    function playRepeatedAudio() {
      // Ses çalmaya başla
      const audio = new Audio(audioUrl);
      audio.loop = true;
      audio.play();
      audioPlayer.src = audioUrl;
    }

    // Kullanıcı ses dosyası yüklediğinde tekrar çalabilmesi için
    const audioInput = document.getElementById('audio-file');
    audioInput.addEventListener('change', () => {
      const file = audioInput.files[0];
      if (file) {
        const audioBlobUrl = URL.createObjectURL(file);
        audioPlayer.src = audioBlobUrl;
        audioPlayer.loop = true; // Arka arkaya çalmasını sağlamak için loop
        status.textContent = 'Ses dosyası yüklendi, çalıyor...';
      }
    });

    // Kayıt bitiminde, ses tekrar çalacak şekilde bir fonksiyon ekledik.
    recordBtn.addEventListener('click', () => {
      // Eğer kayıt yapılmadıysa
      if (!audioUrl) {
        status.textContent = "Lütfen önce ses kaydınızı yapın!";
        return;
      }
      status.textContent = 'Ses çalıyor...';
      playRepeatedAudio();
    });
  </script>
</body>
</html>
